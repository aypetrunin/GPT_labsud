# API
1. Реализовать FastAPI
2. Запуск АПИ
uvicorn start_api:app --reload --port 5000
3. 
на внешку:
uvicorn start_api:app --reload --port 5000 --host 0.0.0.0
3. Развернуто для тестирования

# url = "http://127.0.0.1:5000"
url = "http://109.172.91.211:5000"
4. использование АПИ

import requests

payload = {"text":"Где можно к вам обратиться?", "user_id":"test","dialog":"0"}
response = requests.post("http://127.0.0.1:5000/api/get_answer", json=payload)
from pprint import pprint
pprint(response.json())
---
{'completion_tokens': 0,
 'duration': '1.278294',
 'message': '(ответ из базы вопросов)\n'
            'Вы можете связаться с нами, позвонив по телефону 8 (846) '
            '211-63-65 (все звонки по России бесплатны) или оставив заявку на '
            'обратный звонок на нашем сайте https://federallab.ru/kontaktyi/. '
            'Мы также готовы бесплатно консультировать вас по вопросам '
            'целесообразности производства экспертизы и помогать в поиске '
            'необходимой информации.',
 'message_id': 11,
 'prompt_tokens': 0,
 'question_db': True,
 'refined_query': 'Где можно к вам обратиться?'}
---
payload = {"text":"Автоэкспертиза", "user_id":"test","dialog":"1"}
response = requests.post("http://127.0.0.1:5000/api/get_answer", json=payload)

{'completion_tokens': 407,
 'duration': '14.936107',
 'message': 'ФЛСЭ предоставляет несколько видов автоэкспертизы, включая '
            'экспертизу технического состояния ТС, экспертизу обстоятельств '
            'ДТП и следов ТС, оценку автомобилей, а также автотовароведческую '
            'экспертизу. Автотовароведческая экспертиза сочетает в себе '
            'товароведческую и автотехническую экспертизу, позволяя получить '
            'ответы на вопросы относительно соответствия качества автомобиля '
            'как товара, его узлов и агрегатов данным, указанным в договоре '
            'купли-продажи, а также условиям безопасности эксплуатации. В '
            'случае сложных ситуаций, связанных с дорожно-транспортными '
            'происшествиями или при купле-продаже автомобилей, '
            'профессиональная автотехническая экспертиза ФЛСЭ поможет '
            'разрешить спорные вопросы путем проведения оценки состояния '
            'автомобиля и работ, необходимых для его восстановления после '
            'участия в ДТП. Если у вас возникнут дополнительные вопросы, '
            'пожалуйста, не стесняйтесь задать их.',
 'message_id': 10,
 'prompt_tokens': 1519,
 'question_db': False,
 'refined_query': 'Автоэкспертиза'}

---
requests.get("http://127.0.0.1:5000/requestperhourlist")
[{"start_dt":"2024-01-25T14:11:38.954873","count":5}]

---
Для статистики:
Выставим оценку 2 'message_id': 10,
response = requests.get("http://127.0.0.1:5000/api/add_rating?message_id=10&rate=2")

'ok 2'
